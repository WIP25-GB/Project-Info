# 📘 Deployment TextBook

## 🌐 Chapter 1: VPC and Networking Setup

### 1.1 Create the VPC

We begin by defining our **Virtual Private Cloud (VPC)** to logically isolate our cloud resources.

* **VPC CIDR block:** `10.0.0.0/16`

  * This gives us 65,536 private IP addresses, which is ample for our setup.

### 1.2 Create Subnets

We partitioned the VPC into four subnets:

* **2 Public Subnets** for internet-facing components: Place in 2 AZs

  * `10.0.0.0/24`
  * `10.0.1.0/24`
* **3 Private Subnets** for internal components: Place in 3 AZs

  * `10.0.2.0/24`
  * `10.0.3.0/24`
  * `10.0.4.0/24`

### 1.3 Create Internet Gateway and NAT Gateway

* **Internet Gateway (IGW):** Associated with the VPC we just created.
* **NAT Gateway:** Placed in one of the public subnets to allow private subnet instances to access the internet without being exposed.

### 1.4 Create Route Tables

We create **two route tables**:

#### Public Route Table

* Associated with the **public subnets**
* Add route:
  * Destination: `0.0.0.0/0` → **Internet Gateway**

#### Private Route Table

* Associated with the **private subnets**
* Add route:
  * Destinationt: `0.0.0.0/0` → **NAT Gateway**


### 1.5 Create a keypair
* Go to the EC2 Service
* Click on **Key Pairs**
* Click on Create key pair
* Keep the defaults and provide a name eg `ratingo-keypair`
* Click on Create key pair
* Take note of the private key file downloaded to your computer
* **Change your private key permissons**
  * Windows:
    * Locate the file on your computer
    * Right-click on the file and choose **properties***
    * Click on the Security tab
    * Select Edit and check the deny Write box
    * Repeat this for System, adminstrator and your user
  
  * Mac & Linux
     * Locate the file on your computer and run the command below to change the file permisson
       ```
       chmod 600 ratingo-keypair.pem
       ```


### 1.6 Zero Trust connection to the VPC with Twingate

Zero Trust assumes no device or user is inherently trusted—even if inside your network. Instead of broad VPNs, access is granted per-resource, with authentication, authorization, and monitoring at every step.

* 🔐 Setting Up Twingate Access
  * Create a Twingate Account
    * Go to https://www.twingate.com/
    * Click “Get Started Free” and sign up using Google, Microsoft, or GitHub.
    * Choose AWS Deployment for location and Set your company name, then proceed to create a Twingate Network (e.g., ratingo-network).
  
  * Create a security group for twingate
    * Go to the EC2 service in AWS
    * Select Security group from the left panel
    * Click on Create Security Group
    * Provide a name eg `twingate-sg` and description eg `Security group for twingate connectors`
    * Select the VPC created in step 1.1
    * Click on Create Security Group

  * Deploy connectors
    * Two connectors are created alongside the network
    * Select one of the connectors Choose Deploy Connector → Select AWS AMI from the Script-based Deployments.
    * Click on **Generate Tokens** > Authenticate 
    * Provide the region you are deploying your project to
    * Provide the subnet id for **private-subnet1**
    * Go to the **Run AWS AMI Command** and copy the deployment script
    * Go to the AWS console
    * Click on cloudshell
    * Run the command 
      ```
      nano deploy.sh
      ```
    * Paste the script copied earlier
    * Hit `ctr + o` on your keyboard and then `Enter` to save
    * Hit `ctr + x` and run
      ```
      bash deploy.sh
      ```

      Clean up script
      ```
      rm deploy.sh
      ```
    * Select the second connector and repeat the exact same steps, but select **private-subnet2** for high availability
    * After a few munites, your connectors should turn green

  * Download and authenticate to the twingate client
    * [Download twingate client](https://www.twingate.com/download)
    * provide your network name and authenticate