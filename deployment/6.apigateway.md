## ⚙️ Chapter 6: API Gateway

## 6.1 Create a Security Group for API gateway endpoint
1. Create a security group eg `ratingo-api-sg`.

2. After creating a security group for the ASG, add an inbound rule for HTTPS from that security group.


## 6.2 create an interface VPC endpoint for API Gateway
1. Sign in to the AWS Management Console and open the Amazon VPC console at https://console.aws.amazon.com/vpc/.

2. In the navigation pane, under Virtual private cloud, choose Endpoints.

3. Choose Create endpoint.
    * For Name tag, enter a name to help identify your VPC endpoint.
    * For Service category, choose AWS services.

4. Under Services, in the search bar, enter execute-api. Then, choose the API Gateway service endpoint in the AWS Region where you will create your API. The service name should look like com.amazonaws.us-east-1.execute-api and the Type should be Interface.

5. For VPC, choose the VPC created in chapter 1 and uncheck the **Enable DNS name**.

6. For Subnets, choose the Availability Zones where private ips are and select the priate subnets

7. For Security group, select the security group created in **step 6.1**

8. Choose Create endpoint.


### 6.3 Create API Gateway

We are creating the API Gateway to serve as a single entry point that securely invokes our Lambda functions via HTTP requests.

1. **Log in** to the [AWS Management Console](https://console.aws.amazon.com/).

2. Go to API Gateway > Create API

3. Select **REST API Private**

4. Provide a name. eg `ratingo-api`

5. Select the  **endpoint** created > **Create resource**
    * provide a name eg `now-playing` 
    * check the CORS box

6. Click on **Create resource** one more time
    * ensure the first path `\` is selected on the **Resource path** feild
    * provide a name eg `top-rated`
    * check the CORS box

7. Click on `/now-playing` on the **Resources panel** and then Click on **Methods** and on the **Methods** click on **create method**
    * Choose method type `GET`
    * Choose Lambda function
    * Select the first Lambda function `ratingo-now-playing`
    * Click Create method

8. Repeat same step for `/top-rated` and select the second lambda function

9. Click on **Resource policy** on the left panel > **Create Policy**

10. Choose Select a template and then choose Source VPC.

11. Replace {{vpcID}} (including the curly braces) with your VPC ID and then save

12. Click on **Resources** and click **Deploy API**. Select **No stage**